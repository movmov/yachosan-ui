<div ng-controller="scheduleController as main">
    <form name="scheduleForm" novalidate>
        <div class="panel panel-default">
        <div class="panel-heading">スケジュール登録</div>
        <div class="panel-body">
        <div class="form-horizontal">
        <div class="form-group">
        <div>
            <input ng-model="main.scheduleName" type="text" class="form-control" name="scheduleName" placeholder="スケジュール名を入力してください" tabindex="1" maxlength="32" fs-init-focus required ng-minlength="1" ng-maxlength="32">
                        <span class="error text-danger" ng-show="scheduleForm.scheduleName.$error.required || scheduleForm.scheduleName.$error.minlength">※入力必須項目</span>
                        <span class="error" ng-show="scheduleForm.scheduleName.$error.maxlength">32文字以内で入力してください。</span><br>
        </div>
        <div>
            <input name="scheduleDescription" ng-model="main.scheduleDescription" type="text" class="form-control" placeholder="スケジュール詳細を入力してください" tabindex="1" maxlength="100" fs-init-focus required ng-minlength="1" ng-maxlength="100"><br>
        </div>
        <div>
            <input name="proposedDates" ng-model="main.proposedDates" type="text" class="form-control" placeholder="YYYY-MM-DD,YYYY-MM-DD, ・・・で候補日を入力してください" tabindex="1" fs-init-focus required ng-minlength="1" >
            <span class="error text-danger" ng-show="scheduleForm.proposedDates.$error.required || scheduleForm.proposedDates.$error.minlength">※入力必須項目</span><br>
            <!--
            スケジュール日：<input name="proposedDates" ng-model="main.proposedDates">
            -->
            <!--
            開始日:<input type="text" id="jquery-ui-datepicker"><br>
            <script>
                      $(function() {
                            $( "#jquery-ui-datepicker" ).datepicker();
                        });
            </script>
            -->
        </div>

        <div class="col-xs-6 col-xs-offset-3 text-center">
            <button type="button" ng-click="main.newSchedule()" class="btn btn-primary">スケジュール登録</button><br>
        </div>
        <!--
        <div>
           scheduleName: {{scheduleController.scheduleName}} {{main.scheduleName}}/ scheduleDetail: {{scheduleController.scheduleDetail}} / title: {{main.schedule.scheduleName}} / Detail: {{main.schedule.detail}} / date: {{main.schedule.proposedDates}} / deadline: {{main.schedule.deadline}} / progress: {{main.schedule.progress}} // scheduleId: {{main.schedule.scheduleId}}
        </div>
        -->
        </div></div></div></div>
        <!-- スケジュール詳細表示 with scheduleId -->
        <!--
        <div class="panel panel-default">
        <div class="panel-heading">スケジュール詳細</div>
        <div class="panel-body">
        <div class="form-horizontal">
        <div class="form-group">
        <div>
            <input name="scheduleId" ng-model="main.scheduleId" type="text" class="form-control" placeholder="スケジュールIDを入力してください" tabindex="1"><br>
        </div>
        <div class="col-xs-6 col-xs-offset-3 text-center">
            <button type="button" ng-click="main.getSchedule()" class="btn btn-primary">スケジュール詳細取得</button>
        </div>
        </div></div></div></div>
        -->
        <!-- イベント参加 横スクロール -->
        <!--
        <div class="panel panel-default">
        <div class="panel-heading">イベント参加</div>
        <div class="panel-body">
        <div class="form-horizontal">
        <div class="form-group">
        <div>
            <input name="scheduleId" ng-model="main.scheduleId" type="text" class="form-control" placeholder="スケジュールIDを入力してください" tabindex="1"><br>
        </div>
        <div class="col-xs-6 col-xs-offset-3 text-center">
            <button type="button" ng-click="main.getSchedule()" class="btn btn-primary">イベント情報取得</button>
        </div><br><br>
        <div>
          <table ng-if="main.schedule.proposedDates.length > 0" class="table table-bordered ">
            <tr>
              <th>スケジュール名</th>
              <td>{{main.schedule.scheduleName}}</td>
            </tr>
            <tr>
              <th>スケジュール詳細</th>
              <td>{{main.schedule.scheduleDescription}}</td>
            </tr>
            <tr>
              <th>登録日</th>
              <td>{{main.schedule.createdAt}}</td>
            </tr>
            <tr>
              <th>更新日</th>
              <td>{{main.schedule.updatedAt}}</td>
            </tr>
          </table>
        </div>
        <div>
        <table ng-if="main.schedule.proposedDates.length > 0" name="participants" class="table table-striped table-bordered table-hover table-condensed">
          <thead>
            <tr>
              <th>名前</th>
              <th>コメント</th>
                <th ng-repeat="proposedDate in main.schedule.proposedDates">{{proposedDate}}</th>
            </tr>
          </thead>
          <tr ng-repeat="participant in main.schedule.participants | orderBy:main.predicate:main.reverse" ng-class="{'success':main.isFinished(schedule)}">
            <td>{{participant.nickname}}</td>
            <td>{{participant.comment}}</td>
            <td ng-repeat="reply in participant.replies">{{reply}}</td>
          </tr>
        </table>
        </div>
        <div>
        </div>
        </div></div></div></div>
        -->

        <!-- イベント参加 縦スクロール -->
        <div class="panel panel-default">
        <div class="panel-heading">イベント参加</div>
        <div class="panel-body">
        <div class="form-horizontal">
        <div class="form-group">
        <div>
            <input name="scheduleId" ng-model="main.scheduleId" type="text" class="form-control" placeholder="スケジュールIDを入力してください" tabindex="1"><br>
        </div>
        <div class="col-xs-6 col-xs-offset-3 text-center">
            <button type="button" ng-click="main.getSchedule()" class="btn btn-primary">イベント情報取得</button>
        </div><br><br>
        <div>
          <table ng-if="main.schedule.proposedDates.length > 0" class="table table-bordered ">
            <tr>
              <th>スケジュール名</th>
              <td>{{main.schedule.scheduleName}}</td>
            </tr>
            <tr>
              <th>スケジュール詳細</th>
              <td>{{main.schedule.scheduleDescription}}</td>
            </tr>
            <tr>
              <th>登録日</th>
              <td>{{main.schedule.createdAt}}</td>
            </tr>
            <tr>
              <th>更新日</th>
              <td>{{main.schedule.updatedAt}}</td>
            </tr>
          </table>
        </div>
        <div>
        <!-- ToDo 縦スクロールを無理やり実装しているため酷いコード いつか修正したい -->
        <table ng-if="main.schedule.proposedDates.length > 0" name="participants" class="table table-striped table-bordered table-hover table-condensed">
          <thead>
            <tr>
              <th class="col-sm-2">名前</th>
              <th class="col-sm-3"><input  name="nickname" ng-model="main.participant.nickname" type="text" class="form-control" placeholder="ニックネーム" tabindex="1"></th>
              <th class="col-sm-1" ng-repeat="participant in main.schedule.participants">{{participant.nickname}}</th>
            </tr>
            <tr ng-repeat="(i, proposedDate) in main.schedule.proposedDates">
              <th class="col-sm-2">{{proposedDate}}</th>
              <!-- ToDo 自動改行無効予定 display:inline -->
              <td class="col-sm-3">
                <input type="radio" name="{{proposedDate}}" ng-model="main.participant.replies[proposedDate]" value="OK" checked><p class="text-success">:OK</p>
                <input type="radio" name="{{proposedDate}}" ng-model="main.participant.replies[proposedDate]" value="MAYBE"><p class="text-muted">:MAYBE</p>
                <input type="radio" name="{{proposedDate}}" ng-model="main.participant.replies[proposedDate]" value="NG"><p class="text-danger">:NG</p>
              </td>
              <td class="col-sm-1" ng-repeat="participant in main.schedule.participants">
                  <div ng-switch on="participant.replies[proposedDate]">
                    <div ng-switch-when="OK"><p class="text-success">OK</p></div>
                    <div ng-switch-when="MAYBE"><p class="text-muted">MAYBE</p></div>
                    <div ng-switch-when="NG"><p class="text-danger">NG</p></div>
                  </div>
              </td>
            </tr>
            <tr>
              <th class="col-sm-2">コメント</th>
                <th class="col-sm-3"><textarea  name="comment" ng-model="main.participant.comment" class="form-control" placeholder="コメント" row="3"></textarea></th>
              <th class="col-sm-1" ng-repeat="participant in main.schedule.participants">{{participant.comment}}</th>
            <tr>
              <th class="col-sm-2"></th>
              <td class="col-sm-3"><button type="button" class="btn btn-primary" ng-click="main.newParticipant()">新規登録</button>
              <td class="col-sm-1" ng-repeat="participant in main.schedule.participants">
                <button type="button" class="btn btn-success" ng-click="main.editParticipant()">編集</button>
<button type="button" class="btn btn-danger" ng-click="main.removeParticipant(participant)">削除</button>
              </td>
            </tr>
          </thead>
        </table>
        </div>
        <div>
        </div>
        </div></div></div></div>

        <!-- 全スケジュール情報取得 -->
        <div class="panel panel-default">
        <div class="panel-heading">全スケジュール情報取得</div>
        <div class="panel-body">
        <div class="form-horizontal">
        <div class="form-group">
        <div class="col-xs-6 col-xs-offset-3 text-center">
            <button type="button" ng-click="main.getAllSchedule()" class="btn btn-primary">全スケジュール情報取得</button><br><br>
        </div>
        <div>
        <table ng-if="main.schedules.length > 0" name="schedules" class="table table-striped table-bordered table-hover table-condensed">
          <thead>
            <tr>
              <th>
                <a ng-click="main.predicate = 'scheduleId'; main.reverse=!main.reverse">スケジュールID</a>
                <span class="glyphicon" ng-class="{'glyphicon-sort-by-alphabet':main.predicate==='id' && !main.reverse, 'glyphicon-sort-by-alphabet-alt':main.predicate==='id' && main.reverse}"></span>
              </th>
              <th>
                <a ng-click="main.predicate = 'scheduleName'; main.reverse=!main.reverse">スケジュール名</a>
                <span class="glyphicon" ng-class="{'glyphicon-sort-by-alphabet':main.predicate==='title' && !main.reverse, 'glyphicon-sort-by-alphabet-alt':main.predicate==='title' && main.reverse}"></span>
              </th>
              <th>
                <a ng-click="main.predicate = 'scheduleDescription'; main.reverse=!main.reverse">スケジュール詳細</a>
                <span class="glyphicon" ng-class="{'glyphicon-sort-by-alphabet':main.predicate==='deadline' && !main.reverse, 'glyphicon-sort-by-alphabet-alt':main.predicate==='deadline' && main.reverse}"></span>
              </th>
              <th>
                <a ng-click="main.predicate = 'createdAt'; main.reverse=!main.reverse">登録日</a>
                <span class="glyphicon" ng-class="{'glyphicon-sort-by-alphabet':main.predicate==='progress' && !main.reverse, 'glyphicon-sort-by-alphabet-alt':main.predicate==='progress' && main.reverse}"></span>
              </th>
              <th>
                <a ng-click="main.predicate = 'updatedAt'; main.reverse=!main.reverse">更新日</a>
                <span class="glyphicon" ng-class="{'glyphicon-sort-by-alphabet':main.predicate==='progress' && !main.reverse, 'glyphicon-sort-by-alphabet-alt':main.predicate==='progress' && main.reverse}"></span>
              </th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            <tr ng-repeat="schedule in main.schedules | orderBy:main.predicate:main.reverse" ng-class="{'success':main.isFinished(schedule)}">
              <td class="col-sm-1"><span>{{schedule.scheduleId}}</span></td>
              <td class="col-sm-1"><span>{{schedule.scheduleName}}</span></td>
              <td class="col-sm-1"><span>{{schedule.scheduleDescription}}</span></td>
              <td class="col-sm-1"><span>{{schedule.createdAt | date : "yyyy-MM-dd" }}</span></td>
              <td class="col-sm-1"><span>{{schedule.updatedAt | date : "yyyy-MM-dd" }}</span></td>
              <td class="col-sm-1">
                <button type="button" class="btn btn-primary" ng-click="main.editSchedule(schedule)">編集</button>
                <button type="button" class="btn btn-danger" ng-click="main.removeSchedule(schedule)">削除</button>
              </td>
            </tr>
        </table>    
        </div>
            main.schedules: {{main.schedules}}
        </div></div></div></div>
    </form>
</div>